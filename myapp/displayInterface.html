<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title></title>

<script src="https://zimjs.org/cdn/CreateJS_min.js"></script>
<script src="https://zimjs.org/cdn/2.3.0/socket.io.js"></script>
<script src="https://zimjs.org/cdn/zimserver_urls.js"></script>
<script src="https://zimjs.org/cdn/zimsocket_1.1.js"></script>

<script type=module>
import zim from "https://zimjs.org/cdn/016/zim_socket";

new Frame(FIT, 1024, 768, light, dark, ready);
function ready() {


    let socket;

    function setupMainScreen() {
        const mainScreenContainer = new Container(W,H).center();


        const numUsersLabel = new Label("Users: 1")
                .center()
                .addTo(mainScreenContainer);

        // Establish socket connection
        const appName = "pokemotion";
        socket = new Socket(zimSocketURL, appName); 

        // Listen for socket events
        socket.on("ready", function() {
            zog("Connected to socket");
            // Display the initial number of users
            numUsersLabel.text = "Users: " + (socket.size + 1);
            S.update();
        });

        socket.on("otherjoin", function () {
            // Update the number of users when someone else joins
            numUsersLabel.text = "Users: " + (socket.size + 1);
            S.update();
            
            // Check if the total number of users is 3 to transition to the main screen
            if (socket.size + 1 === 3) {
                transitionToMainScreen();
            }
        });

        socket.on("otherleave", function () {
            // Update the number of users when someone leaves
            numUsersLabel.text = "Users: " + (socket.size + 1);
            S.update();
        });

        socket.on("error", function () {
            numUsersLabel.text = "Error occurred";
            S.update();
        });

        // Listen for button press event on controller device
        controller.on("button", function(data) {
            // Send the button press data to the main screen
            sendInstructionToMainScreen(data.button);
        });
        
        // Listen for direction pad press event on controller device
        controller.on("dpad", function(data) {
            // Send the direction pad press data to the main screen
            sendInstructionToMainScreen(data.direction);
        });
    }

    setupMainScreen()

    function transitionToMainScreen() {
        // Code for transitioning to the main screen with instructions
        // For example, fade in the "PokeMotion" label and instructions
        const pokeMotionLabel = new Label("PokeMotion")
                .centerReg()
                .mov(0, -100) // Adjust position as needed
                .alp(0) // Start with opacity 0 for fade-in effect
                .fade(1, 1000); // Fade in over 1 second

        const instructionsText = "PokeMotion mimics the beloved Pokemon battle sequence with a twist. Instead of type advantages and status ailments, the effectiveness of a move is determined by the user's device motion. After choosing a move, vigorously shake your device to determine the damage output. The last player standing wins.";

        const instructionsLabel = new Label(instructionsText)
                .centerReg()
                .mov(0, 100) // Adjust position as needed
                .alp(0) // Start with opacity 0 for fade-in effect
                .fade(1, 1000); // Fade in over 1 second

        S.update(); // Update the stage to apply the changes
    }

    function sendInstructionToMainScreen(instruction) {
        // Send instruction to the main screen
        socket.emit("instruction", instruction);
    }
}//end ready
</script>
</head>
<body onload="setupMainScreen()">
<!-- Main Screen HTML Content -->
</body>
</html>
